var ListadoControllerBase={InyectarDependencia:function(a,b){Ext.apply(a,{permisos:null,store_params:{},params:null});Ext.apply(a.getView(),{paramsEntrada:{modoEjecucion:null,verColEditar:null,verColBorrar:null},datosRetorno:{itemsSeleccionados:[]}});a.permisos=sesionUsuario.GetPermiso(b);ControllerBase.InyectarDependencia(a);a.onBtnAceptarClick=this.onBtnAceptarClick;a.onBtnCancelarClick=this.onBtnCancelarClick;a.onRender=this.onRender;a.onFilterComboRender=this.onFilterComboRender;a.onFilterComboSelect=this.onFilterComboSelect;a.onBtnBuscarClick=this.onBtnBuscarClick;a.onBtnLimpiarFiltrosClick=this.onBtnLimpiarFiltrosClick;a.onEditarRegistroGrilla=this.onEditarRegistroGrilla;a.onBorrarRegistroGrilla=this.onBorrarRegistroGrilla;a.onBtnRecargarListadoClick=this.onBtnRecargarListadoClick;a.onBtnNuevoClick=this.onBtnNuevoClick;a.onListadoGrillaCellDblClick=this.onListadoGrillaCellDblClick;a.AgregarItemsSeleccionados=this.AgregarItemsSeleccionados;a.ConfigurarModoVista=this.ConfigurarModoVista;a.ConfigurarModoSeleccion=this.ConfigurarModoSeleccion;a.ConfigurarModoSeleccionIndividual=this.ConfigurarModoSeleccionIndividual;a.RefrescarGrilla=this.RefrescarGrilla;a.RefrescarFiltros=this.RefrescarFiltros;a.ConfigurarPantalla=this.ConfigurarPantalla;a.SetDatoSalida=this.SetDatoSalida;a.CargarStoreParams=this.CargarStoreParams;a.IntentarCerrarVentanaContenedora=this.IntentarCerrarVentanaContenedora;a.CargarParametrosFiltro=this.CargarParametrosFiltro;a.GetComponenteFoco=this.GetComponenteFoco;a.AplicarParametrosDeEntrada=this.AplicarParametrosDeEntrada;a.InicializarListado=this.InicializarListado;a.SeleccionarItemIndividual=this.SeleccionarItemIndividual;a.CambiarValorFiltro=this.CambiarValorFiltro;a.EditarRegistro=this.EditarRegistro;a.onGridStoreBeforeLoad=this.onGridStoreBeforeLoad;a.onFilterTextoBlur=this.onFilterTextoBlur;a.onFilterTextoSpecialKey=this.onFilterTextoSpecialKey;a.onTbBuscarSpecialKey=this.onTbBuscarSpecialKey;a.onFilterFechaChange=this.onFilterFechaChange;a.AplicarConfiguracionDeSeguridad=this.AplicarConfiguracionDeSeguridad;a.CrearStoreGrilla=this.CrearStoreGrilla},onGridStoreBeforeLoad:function(b,a){a.params=Ext.apply(a.params||{},this.store_params)},onBtnAceptarClick:function(){var a=this.getView().down("grid").getStore();var b=Array();a.each(function(d,c){if(d.get("seleccion")==true){b.push(d)}});this.SetDatoSalida("itemsSeleccionados",b);this.SetDatoSalida("accion",AccionRetorno.Guardar);this.IntentarCerrarVentanaContenedora()},onBtnCancelarClick:function(){this.SetDatoSalida("itemsSeleccionados",[]);this.IntentarCerrarVentanaContenedora()},onRender:function(){this.InicializarListado()},onFilterComboRender:function(b,a){},onFilterComboSelect:function(b,c,a){this.store_params[b.filterName]=b.value;this.RefrescarGrilla({start:0,page:1})},onBtnBuscarClick:function(){this.onBtnRecargarListadoClick()},onBtnLimpiarFiltrosClick:function(){var c=this.getView().query("fieldset[name='FilterFieldSet'] combo");var d=this;c.forEach(function(e){e.clearValue();delete d.store_params[e.filterName]});var a=this.getView().query("fieldset[name='FilterFieldSet'] datefield");a.forEach(function(e){e.setValue("");delete d.store_params[e.filterName]});var b=this.getView().query("fieldset[name='FilterFieldSet'] textfield");b.forEach(function(e){e.setValue("");delete d.store_params[e.filterName]});this.RefrescarGrilla()},onEditarRegistroGrilla:function(b,d,a){var c=b.getStore().getAt(d);this.EditarRegistro(c)},onBtnNuevoClick:function(){var b=this;var c=Ext.create(this.params.nuevaEntidad,{});c.paramsEntrada=b.GetOnNuevoParamsEntrada(b.getView().paramsEntrada);var a=c.getController().GetComponenteFoco();var d=Ext.create("Ext.window.Window",{title:c.controller.params.nombreEntidad+": Crear",height:c.controller.params.altoVentana,width:c.controller.params.anchoVentana,modal:this.params.ventanaModal,maximizable:this.params.ventanaMaximizable,maximized:this.params.ventanaMaximized,collapsible:!this.params.ventanaModal,resizable:false,layout:"fit",defaultFocus:a,listeners:{close:function(){if(b.getView()!=null){b.AgregarItemsSeleccionados(c.datosRetorno,function(){b.RefrescarGrilla();b.RefrescarFiltros()})}this.remove(c)}}});d.add(c);d.show()},onBorrarRegistroGrilla:function(b,d,a){var c=this;Ext.MessageBox.confirm("Borrar","Esta seguro de que desea borrar el registro?",function(e){if(e==="yes"){b.getStore().getAt(d).erase({success:function(){c.RefrescarGrilla();c.RefrescarFiltros()}})}})},onBtnRecargarListadoClick:function(){this.RefrescarGrilla()},onListadoGrillaCellDblClick:function(c,e,b,a,d){this.SeleccionarItemIndividual(c.getRecord(d))},onFilterTextoBlur:function(a,b){this.CambiarValorFiltro(a.filterName,a.getValue())},onFilterTextoSpecialKey:function(a,b){if(b.getKey()==b.ENTER||b.getKey()==b.TAB){this.CambiarValorFiltro(a.filterName,a.getValue())}},onFilterFechaChange:function(a,b){this.CambiarValorFiltro(a.filterName,a.getSubmitValue())},onTbBuscarSpecialKey:function(){this.onBtnRecargarListadoClick()},CrearStoreGrilla:function(){var b=Ext.create(this.params.storeGrilla,{autoDestroy:true});var c=this.getView().down("grid");var a=this.getView().down("pagingtoolbar");c.reconfigure(b);if(a!=null){a.bindStore(b)}},SeleccionarItemIndividual:function(b){var a=Array();if(this.params.modoEjecucion==ModoEjecucionListado.SeleccionIndividual){a.push(b);this.SetDatoSalida("itemsSeleccionados",a);this.SetDatoSalida("accion",AccionRetorno.Guardar);this.IntentarCerrarVentanaContenedora()}else{this.EditarRegistro(b)}},EditarRegistro:function(b){if(this.permisos.verRegistro){var c=this,a;var d=Ext.create(this.params.editarEntidad,{});d.paramsEntrada=c.GetOnEditarParamsEntrada(b,c.getView().paramsEntrada);a=d.getController().GetComponenteFoco();var e=Ext.create("Ext.window.Window",{title:d.controller.params.nombreEntidad+": Editar",height:d.controller.params.altoVentana,width:d.controller.params.anchoVentana,modal:this.params.ventanaModal,maximizable:this.params.ventanaMaximizable,maximized:this.params.ventanaMaximized,collapsible:!this.params.ventanaModal,resizable:false,defaultFocus:a,layout:"fit",listeners:{close:function(){this.remove(d);if(c.getView()!=null){c.RefrescarGrilla();c.RefrescarFiltros()}}}});e.add(d);e.show()}},GetComponenteFoco:function(){return this.getView().down("textfield[name='tbBuscar']")},AgregarItemsSeleccionados:function(a,d){var c=this.getView().paramsEntrada;if(a.itemsSeleccionados!=null){for(var b=0;b<a.itemsSeleccionados.length;b++){this.GuardarItemSeleccionado(a.itemsSeleccionados[b],c)}}d()},ConfigurarModoVista:function(){this.getView().down("button[name='btnCancelar']").hide();this.getView().down("button[name='btnAceptar']").hide();this.getView().down("checkcolumn[name='colSeleccion']").hide();this.getView().down("actioncolumn[name='colEditar']").hide()},ConfigurarModoSeleccion:function(){this.getView().down("button[name='btnExportar']").hide();this.getView().down("actioncolumn[name='colEditar']").hide()},ConfigurarModoSeleccionIndividual:function(){this.getView().down("button[name='btnCancelar']").hide();this.getView().down("button[name='btnAceptar']").hide();this.getView().down("checkcolumn[name='colSeleccion']").hide()},RefrescarGrilla:function(a){this.getView().down("grid").store.proxy.extraParams=this.store_params;if(a!=undefined){this.getView().down("grid").store.load(a)}else{this.getView().down("grid").store.load()}},RefrescarFiltros:function(){var c=this.getView().query("fieldset[name='FilterFieldSet'] combo");var b;var d=this;for(i=0;i<c.length;i++){b=this.CargarParametrosFiltro(this.getView().paramsEntrada,c[i].filterName);if(c[i].autoCarga){var a=Ext.create("Ext.data.Store",{fields:["id_field","desc_field"],proxy:{type:"ajax",url:d.params.comboFiltrosUrl,reader:{type:"json",rootProperty:"root"}}});c[i].store=a;b.fname=c[i].filterName}else{a=c[i].store}a.load({params:b})}},InicializarListado:function(){this.AplicarParametrosDeEntrada(this.getView().paramsEntrada,this.params);this.CargarStoreParams(this.store_params,this.params);this.CrearStoreGrilla();this.ConfigurarPantalla();this.RefrescarGrilla()},AplicarParametrosDeEntrada:function(b,a){if(b.modoEjecucion!=null){a.modoEjecucion=b.modoEjecucion}if(b.verColEditar!=null){a.verColEditar=b.verColEditar}if(b.verColBorrar!=null){a.verColBorrar=b.verColBorrar}},ConfigurarPantalla:function(){switch(this.params.modoEjecucion){case ModoEjecucionListado.SeleccionIndividual:this.ConfigurarModoSeleccionIndividual();break;case ModoEjecucionListado.Seleccion:this.ConfigurarModoSeleccion();break;default:this.ConfigurarModoVista();break}if(!this.params.verColEditar){this.getView().down("actioncolumn[name='colEditar']").hide()}if(!this.params.verColBorrar){this.getView().down("actioncolumn[name='colBorrar']").hide()}this.AplicarConfiguracionDeSeguridad();this.RefrescarFiltros()},AplicarConfiguracionDeSeguridad:function(){this.getView().down("button[name='btnNuevo']").setDisabled(!this.permisos.crear);if(!this.permisos.borrar){this.getView().down("actioncolumn[name='colBorrar']").hide()}if(!this.permisos.verRegistro){this.onEditarRegistroGrilla=function(){}}},IntentarCerrarVentanaContenedora:function(){var b=this.getView();var a=b.up("window");if(a!=null){a.close()}},SetDatoSalida:function(b,a){this.getView().datosRetorno[b]=a},CambiarValorFiltro:function(b,a){if(a!=""){this.store_params[b]=a;this.RefrescarGrilla()}},CargarStoreParams:function(a,b){},GuardarItemSeleccionado:function(a,b){},CargarParametrosFiltro:function(b,a){return{}}};